<!DOCTYPE html>
{% extends "base.html" %} {% block content %}

<div class="container">
  <div
    class="row"
    style="display: flex; justify-content: space-between; margin: 0"
  >
    <h4 style="color: rgb(0, 68, 171)">
      <a href="{{ url_for('student_info', id=cadet.id )}}"
        >{{ cadet.first_name }} {{ cadet.middle_name }} {{ cadet.last_name }}</a
      >
      <span>
        <a
          type="btn"
          style="font-size: small; float: right"
          href="{{ url_for('add_academic_score', id=cadet.id) }}"
          class="card-link"
          >See Academic results</a
        ><br />
        <a
          type="btn"
          style="font-size: small; float: right"
          href="{{ url_for('add_military_score', id=cadet.id) }}"
          class="card-link"
          >See Military results</a
        >
      </span>
    </h4>

    <p class="card-subtitle mb-2 text-body-secondary">
      {{ cadet.bn.bn.capitalize() }} ({{ cadet.service.service_type.upper() }})
    </p>
    <p class="card-text">
      Department |
      <b style="color: rgb(0, 68, 171)"
        >{{ cadet.department.department_name.title() }}</b
      >
    </p>
    <!-- <p>
      Diagnosis:
      <b style="color: #f90b31"></b>
    </p> -->
  </div>

  <div class="row">
    {% with messages = get_flashed_messages() %} {% if messages %}
    <ul class="flashes">
      {% for message in messages %}
      <li style="font-size: smaller">{{ message }}</li>
      {% endfor %}
    </ul>
    {% endif %} {% endwith %}
    <div class="col">
      <!-- Form for entering academic scores -->
      <form
        id="medial-record-form"
        method="POST"
        action="{{ url_for('add_medical_record', id=cadet.id) }}"
      >
        {{ medical_record_form.csrf_token() }}
        <p>Enter Record:</p>
        <table class="custom-table table-sm table-hover table-borderless">
          <thead style="font-size: small">
            <tr>
              <th style="width: 10%" scope="col">Diagnosis</th>
              <th style="width: 5%" scope="col">Excuse Duty</th>
              <th style="width: 5%" scope="col">Days</th>
              <th style="width: 5%" scope="col">Admitted</th>
              <th style="width: 5%" scope="col">Discharged</th>
              <th style="width: 5%" scope="col"></th>
            </tr>
          </thead>
          <tbody
            style="text-align: center; font-size: small"
            id="cadet-table-body"
          >
            <!-- Initial row for data entry -->
            <tr class="active-row">

              <td data-cell="Diagnosis" class="head-center">
                {{ medical_record_form.diagnosis(class="form-control",
                placeholder="Diagnosis") }}
              </td>
              <td data-cell="Excuse Duty Type" class="head-center">
                {{ medical_record_form.excuse_duty_type(class="form-control",
                placeholder="Service Year") }}
              </td>
              <td data-cell="Days" class="head-center">
                {{ medical_record_form.excuse_duty_days(class="form-control",
                placeholder="Days") }}
              </td>
              <td data-cell="Admitted" class="head-center">
                {{ medical_record_form.admitted(class="form-control",
                placeholder="Service Year") }}
              </td>
              <td data-cell="Discharged" class="head-center">
                {{ medical_record_form.discharged(class="form-control",
                placeholder="Service Year") }}
              </td>
              <td data-cell="Submit" style="padding: 5px">
                <div class="form-group" style="text-align: center">
                  {{ medical_record_form.submit( class="btn btn-primary btn-sm")
                  }}
                </div>
              </td>
            </tr>
          </tbody>
        </table>
      </form>
    </div>

    <div class="col">
      <p>Medical Records:</p>
      <table class="custom-table table-sm table-hover table-borderless">
        <thead style="text-align: center">
          <tr>
            <th style="width: 1%" scope="col">Ser</th>
            <th style="width: 20%" scope="col">Date</th>
            <th style="width: 10%" scope="col">Diagnosis</th>
            <th style="width: 5%" scope="col">Excuse Duty</th>
            <th style="width: 5%" scope="col">Days</th>
            <th style="width: 5%" scope="col">Admitted</th>
            <th style="width: 5%" scope="col">Discharged</th>
            <th style="width: 1%" scope="col"></th>
          </tr>
        </thead>
        <tbody style="font-size: small" id="cadet-table-body">
          {% for row in rows %}
          <!-- Initial row for data entry -->
          <tr class="active-row">
            <th class="card-heading-text" scope="row">
              {{ (page - 1) * per_page + loop.index }}
            </th>
            <td data-cell="date">{{ row.date_reported_sick.strftime('%d %B %Y').lstrip('0').replace(' 0', ' ') }}</td>
            <td data-cell="diagnosis" class="head-center">
              {{ row.diagnosis.title() }}
            </td>
            <td data-cell="excuse_duty_type" class="head-center">
              {{row.excuse_duty_type.title() }}
            </td>
            <td data-cell="excuse_duty_days" class="head-center">
              {{row.excuse_duty_days }}
            </td>
            <td data-cell="admitted" class="head-center">
              {{ row.admitted.title() }}
            </td>
            <td data-cell="discharged" class="head-center">
              {{ row.discharged.title() }}
            </td>
            <td data-cell="remove record" class="head-center">
              <a
                href="#"
                onclick="confirmDelete('{{ url_for('remove_medical_record', id=row.id, cadet_id=row.cadet_id) }}')"
                ><i style="color: #f90b31" class="fas fa-minus-circle fa-md"></i
              ></a>
            </td>
          </tr>

          {% endfor %}
          <!-- Additional rows will be dynamically added here -->
        </tbody>
      </table>
    </div>
  </div>

  <div class="row"></div>
</div>

<!-- JavaScript to handle dynamic row addition and form submission -->
<script>
  function confirmDelete(url) {
    if (confirm("Are you sure you want to delete this record?")) {
      window.location.href = url;
    }
  }
</script>

{% endblock %}
